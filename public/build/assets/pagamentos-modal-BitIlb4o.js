import{s as i,a as b}from"./alert-DLWxqPIg.js";import{M as m}from"./bootstrap.esm-D_BmgoUQ.js";document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("partialPaymentModal"),l=document.getElementById("partialPaymentForm"),p=document.getElementById("valor_recebido_input"),g=document.getElementById("observacao_input");if(!d||!l||!p||!g)return;const v=()=>{var t,e;return((t=m)==null?void 0:t.getOrCreateInstance)&&m.getOrCreateInstance(d)||((e=m)==null?void 0:e.getInstance)&&m.getInstance(d)||new m(d)};document.querySelectorAll(".open-partial-btn").forEach(t=>{t.addEventListener("click",e=>{const s=e.currentTarget,r=s.getAttribute("data-action")??"",n=s.getAttribute("data-valor-devido")??"0";l.setAttribute("action",r);const c=parseFloat(n)||0;p.value=c.toFixed(2).replace(".",","),g.value="";try{v().show()}catch(o){console.warn("[pagamentos-modal] show modal failed",o)}})});function w(t){let e=(t||"").trim();return e=e.replace(/\s+/g,""),e=e.replace(/\.(?=\d{3}(?:[^\d]|$))/g,""),e=e.replace(/,/,"."),e}async function y(t,e){var r;if(!t)throw new Error("Form action not set");return await fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)??""},body:e.toString()})}l.addEventListener("submit",async t=>{t.preventDefault();const e=p.value||"",s=w(e),r=parseFloat(s);if(!isFinite(r)||r<0){i("error","Informe um valor válido para o pagamento.");return}const n=new URLSearchParams;n.set("valor_recebido",r.toFixed(2)),n.set("observacao",g.value||"");try{const c=l.getAttribute("action")??"",o=await y(c,n);if(!o.ok){let a=null;try{a=await o.json()}catch{}const f=a&&a.message||"Erro ao registrar pagamento";i("error",f);return}try{v().hide()}catch{}i("success","Pagamento registrado com sucesso",1500),setTimeout(()=>{window.location.reload()},800)}catch(c){console.error("[pagamentos-modal] submit error",c),i("error","Erro de rede. Tente novamente.")}});const u=document.getElementById("mark-all-form");u&&u.addEventListener("submit",async t=>{var c;if(t.preventDefault(),!await b("Marcar todos como pagos","Deseja marcar TODOS os pagamentos visíveis como pagos? Essa ação não pode ser revertida facilmente."))return;const s=u.getAttribute("action")??"",r=new FormData(u),n=new URLSearchParams;for(const[o,a]of r.entries())n.set(o,String(a));try{const o=await fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-CSRF-TOKEN":((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.content)??""},body:n.toString()});if(!o.ok){let a=null;try{a=await o.json()}catch{}const f=a&&a.message||"Erro ao marcar todos como pagos";i("error",f);return}i("success","Todos os pagamentos foram marcados como pagos.",1500),setTimeout(()=>window.location.reload(),700)}catch(o){console.error("[mark-all] error",o),i("error","Erro de rede. Tente novamente.")}})});
