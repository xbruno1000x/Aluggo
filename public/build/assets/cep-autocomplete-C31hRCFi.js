function d(t=""){const e=t?`${t}cep`:"cep",r=document.getElementById(e);if(!r)return;const o={cep:r,endereco:document.getElementById(t?`${t}endereco`:"endereco"),bairro:document.getElementById(t?`${t}bairro`:"bairro"),cidade:document.getElementById(t?`${t}cidade`:"cidade"),estado:document.getElementById(t?`${t}estado`:"estado")};r.addEventListener("input",a=>{const c=a.target;let n=c.value.replace(/\D/g,"");n.length>5&&(n=n.substring(0,5)+"-"+n.substring(5,8)),c.value=n,i(o)}),r.addEventListener("blur",async()=>{const a=r.value.replace(/\D/g,"");a.length===8&&await u(a,o,t)})}function i(t){[t.endereco,t.bairro,t.cidade,t.estado].forEach(r=>{r&&(r.readOnly=!1,r.classList.remove("bg-light","text-muted"))})}async function u(t,e,r){e.cep&&(e.cep.classList.add("is-loading"),e.cep.disabled=!0);try{const o=await fetch(`https://viacep.com.br/ws/${t}/json/`);if(!o.ok)throw new Error("Erro ao buscar CEP");const a=await o.json();if(a.erro){s("CEP nÃ£o encontrado",r);return}e.endereco&&a.logradouro&&(e.endereco.value=a.logradouro,e.endereco.readOnly=!0,e.endereco.classList.add("bg-light","text-muted")),e.bairro&&a.bairro&&(e.bairro.value=a.bairro,e.bairro.readOnly=!0,e.bairro.classList.add("bg-light","text-muted")),e.cidade&&a.localidade&&(e.cidade.value=a.localidade,e.cidade.readOnly=!0,e.cidade.classList.add("bg-light","text-muted")),e.estado&&a.uf&&(e.estado.value=a.uf,e.estado.readOnly=!0,e.estado.classList.add("bg-light","text-muted")),e.cep&&(e.cep.classList.add("is-valid"),setTimeout(()=>{e.cep.classList.remove("is-valid")},2e3))}catch(o){console.error("Erro ao buscar CEP:",o),s("Erro ao buscar CEP. Tente novamente.",r)}finally{e.cep&&(e.cep.classList.remove("is-loading"),e.cep.disabled=!1)}}function s(t,e){if(e==="p_"){const a=document.getElementById("propriedade-form-alert");if(a){a.className="alert alert-warning",a.textContent=t,a.classList.remove("d-none"),setTimeout(()=>{a.classList.add("d-none")},5e3);return}}const r=document.querySelector("form");if(!r)return;let o=r.querySelector(".alert-cep");o||(o=document.createElement("div"),o.className="alert alert-warning alert-cep",o.setAttribute("role","alert"),r.insertBefore(o,r.firstChild)),o.textContent=t,o.classList.remove("d-none"),setTimeout(()=>{o.classList.add("d-none")},5e3)}document.addEventListener("DOMContentLoaded",()=>{d("p_"),d("")});
