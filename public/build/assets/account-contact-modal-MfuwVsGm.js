document.addEventListener("DOMContentLoaded",()=>{p(),g()});function f(){var e;const t=document.cookie.split(";");for(let n of t){const[i,o]=n.trim().split("=");if(i==="XSRF-TOKEN")return decodeURIComponent(o)}return((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""}function p(){const t=document.getElementById("email-form");if(!t)return;const e=document.getElementById("email-form-alert"),n=document.getElementById("btn-submit-email");t.addEventListener("submit",async i=>{if(i.preventDefault(),!e||!n)return;const o=n.querySelector(".btn-text"),l=n.querySelector(".spinner-border"),a=()=>{n&&o&&l&&(n.disabled=!1,o.classList.remove("d-none"),l.classList.add("d-none"))};e.classList.add("d-none"),e.classList.remove("alert-success","alert-danger"),e.textContent="";const m=new FormData(t),u=Object.fromEntries(m.entries());try{const r=await fetch(t.action,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f(),Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(u)}),s=await r.json();if(r.ok){e.classList.remove("d-none","alert-danger"),e.classList.add("alert-success"),e.textContent=s.status||"E-mail alterado com sucesso!";const d=document.getElementById("current_email");d&&s.email&&(d.value=s.email),t.reset(),a(),setTimeout(()=>{const c=bootstrap.Modal.getInstance(document.getElementById("emailModal"));c==null||c.hide(),setTimeout(()=>{e.classList.add("d-none")},300)},2e3)}else e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent=s.message||"Erro ao alterar e-mail.",a()}catch{e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent="Erro ao processar a solicitação.",a()}})}function g(){const t=document.getElementById("phone-form");if(!t)return;const e=document.getElementById("phone-form-alert"),n=document.getElementById("btn-submit-phone");t.addEventListener("submit",async i=>{if(i.preventDefault(),!e||!n)return;const o=n.querySelector(".btn-text"),l=n.querySelector(".spinner-border"),a=()=>{n&&o&&l&&(n.disabled=!1,o.classList.remove("d-none"),l.classList.add("d-none"))};e.classList.add("d-none"),e.classList.remove("alert-success","alert-danger"),e.textContent="";const m=new FormData(t),u=Object.fromEntries(m.entries());try{const r=await fetch(t.action,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f(),Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(u)}),s=await r.json();if(r.ok){e.classList.remove("d-none","alert-danger"),e.classList.add("alert-success"),e.textContent=s.status||"Telefone alterado com sucesso!";const d=document.getElementById("current_phone");d&&s.telefone&&(d.value=s.telefone),t.reset(),a(),setTimeout(()=>{const c=bootstrap.Modal.getInstance(document.getElementById("phoneModal"));c==null||c.hide(),setTimeout(()=>{e.classList.add("d-none")},300)},2e3)}else e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent=s.message||"Erro ao alterar telefone.",a()}catch{e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent="Erro ao processar a solicitação.",a()}})}
