document.addEventListener("DOMContentLoaded",()=>{p(),L()});function f(){var t;return((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""}function p(){const t=document.getElementById("email-form");if(!t)return;const e=document.getElementById("email-form-alert"),n=document.getElementById("btn-submit-email");t.addEventListener("submit",async m=>{if(m.preventDefault(),!e||!n)return;const d=n.querySelector(".btn-text"),i=n.querySelector(".spinner-border"),o=()=>{n&&d&&i&&(n.disabled=!1,d.classList.remove("d-none"),i.classList.add("d-none"))};e.classList.add("d-none"),e.classList.remove("alert-success","alert-danger"),e.textContent="";const u=new FormData(t),a=Object.fromEntries(u.entries());delete a._token,delete a._method;try{const r=await fetch(t.action,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f(),Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(a)}),s=await r.json();if(r.ok){e.classList.remove("d-none","alert-danger"),e.classList.add("alert-success"),e.textContent=s.status||"E-mail alterado com sucesso!";const l=document.getElementById("current_email");l&&s.email&&(l.value=s.email),t.reset(),o(),setTimeout(()=>{const c=bootstrap.Modal.getInstance(document.getElementById("emailModal"));c==null||c.hide(),setTimeout(()=>{e.classList.add("d-none")},300)},2e3)}else e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent=s.message||"Erro ao alterar e-mail.",o()}catch{e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent="Erro ao processar a solicitação.",o()}})}function L(){const t=document.getElementById("phone-form");if(!t)return;const e=document.getElementById("phone-form-alert"),n=document.getElementById("btn-submit-phone");t.addEventListener("submit",async m=>{if(m.preventDefault(),!e||!n)return;const d=n.querySelector(".btn-text"),i=n.querySelector(".spinner-border"),o=()=>{n&&d&&i&&(n.disabled=!1,d.classList.remove("d-none"),i.classList.add("d-none"))};e.classList.add("d-none"),e.classList.remove("alert-success","alert-danger"),e.textContent="";const u=new FormData(t),a=Object.fromEntries(u.entries());delete a._token,delete a._method;try{const r=await fetch(t.action,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f(),Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(a)}),s=await r.json();if(r.ok){e.classList.remove("d-none","alert-danger"),e.classList.add("alert-success"),e.textContent=s.status||"Telefone alterado com sucesso!";const l=document.getElementById("current_phone");l&&s.telefone&&(l.value=s.telefone),t.reset(),o(),setTimeout(()=>{const c=bootstrap.Modal.getInstance(document.getElementById("phoneModal"));c==null||c.hide(),setTimeout(()=>{e.classList.add("d-none")},300)},2e3)}else e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent=s.message||"Erro ao alterar telefone.",o()}catch{e.classList.remove("d-none","alert-success"),e.classList.add("alert-danger"),e.textContent="Erro ao processar a solicitação.",o()}})}
