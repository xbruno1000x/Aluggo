import{s as i}from"./alert-DLWxqPIg.js";document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("propriedade-form"),a=document.getElementById("propriedadeModal"),l=document.getElementById("propriedade_id");if(!r||!a||!l)return;const u=r.dataset.endpoint??"",f=r.dataset.csrf??"";async function y(c){return fetch(u,{method:"POST",headers:{"X-CSRF-TOKEN":f,Accept:"application/json"},body:c})}r.addEventListener("submit",async c=>{var p,m;c.preventDefault();const g=new FormData(r),t=document.getElementById("btn-submit-propriedade"),d=t==null?void 0:t.querySelector(".btn-text"),s=t==null?void 0:t.querySelector(".spinner-border");t&&d&&s&&(t.disabled=!0,d.classList.add("d-none"),s.classList.remove("d-none"));try{const o=await y(g);if(!o.ok){let e=null;try{(o.headers.get("content-type")??"").includes("application/json")&&(e=await o.json())}catch{}const b=e&&e.message||"Erro ao criar propriedade";i("error",b);return}let n=null;try{(o.headers.get("content-type")??"").includes("application/json")&&(n=await o.json())}catch(e){console.warn("[propriedade-modal] não foi possível parsear JSON da resposta",e)}if(n&&n.id!==void 0){const e=document.createElement("option");e.value=String(n.id),e.text=String(n.nome??`Propriedade ${n.id}`),e.selected=!0,l.appendChild(e)}try{const e=((p=bootstrap==null?void 0:bootstrap.Modal)==null?void 0:p.getOrCreateInstance)&&bootstrap.Modal.getOrCreateInstance(a)||((m=bootstrap==null?void 0:bootstrap.Modal)==null?void 0:m.getInstance)&&bootstrap.Modal.getInstance(a)||new bootstrap.Modal(a);e==null||e.hide()}catch(e){console.warn("[propriedade-modal] fallback para fechar modal",e)}r.reset(),i("success","Propriedade criada com sucesso",2e3)}catch(o){console.error("[propriedade-modal] submit error",o),i("error","Erro de rede. Tente novamente.")}finally{t&&d&&s&&(t.disabled=!1,d.classList.remove("d-none"),s.classList.add("d-none"))}})});
