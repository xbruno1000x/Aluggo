const g=["monthSales","monthPurchases","monthRent","monthObra","monthTaxas"],T=["monthSales","monthRent"],x=["monthPurchases","monthObra","monthTaxas"],R=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}),d=()=>({monthSales:!0,monthPurchases:!0,monthRent:!0,monthObra:!0,monthTaxas:!0});function u(e){const t=e<0?"-":"",r=Math.abs(e);return`${t}R$ ${R.format(r)}`}const E=e=>!!e&&g.includes(e),N=e=>e.map(t=>({label:String(t.label??""),monthSales:Number(t.monthSales??0),monthPurchases:Number(t.monthPurchases??0),monthRent:Number(t.monthRent??0),monthObra:Number(t.monthObra??0),monthTaxas:Number(t.monthTaxas??0),delta:Number(t.delta??0),cumulative:Number(t.cumulative??0)})),b=(e,t)=>{const r={...t};return e.forEach(n=>{const a=n.dataset.key;E(a)&&(r[a]=n.checked)}),r},S=(e,t)=>{let r=0;return e.map(n=>{const a={label:n.label,monthSales:t.monthSales?n.monthSales:0,monthPurchases:t.monthPurchases?n.monthPurchases:0,monthRent:t.monthRent?n.monthRent:0,monthObra:t.monthObra?n.monthObra:0,monthTaxas:t.monthTaxas?n.monthTaxas:0,delta:0,cumulative:0},o=T.reduce((s,l)=>s+(t[l]?n[l]:0),0),c=x.reduce((s,l)=>s+(t[l]?n[l]:0),0);return a.delta=o-c,r+=a.delta,a.cumulative=r,a})},O=(e,t)=>{!e||!e.data||!e.data.datasets||!e.data.datasets[0]||(e.data.datasets[0].data=t.map(r=>r.cumulative),e.update())},f=(e,t)=>{e.length&&e.forEach((r,n)=>{const a=t[n];if(!a)return;const o=(c,s)=>{const l=r.querySelector(`[data-field="${c}"]`);l&&(l.textContent=s)};o("monthSales",u(a.monthSales)),o("monthPurchases",u(a.monthPurchases)),o("monthRent",u(a.monthRent)),o("monthObra",u(a.monthObra)),o("monthTaxas",u(a.monthTaxas)),o("delta",u(a.delta)),o("cumulative",u(a.cumulative))})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("patrimonioChart");if(!e)return;const t=e.getAttribute("data-series");if(!t)return;let r;try{r=JSON.parse(t)}catch{return}if(!Array.isArray(r)||!r.length)return;const n=N(r);if(!n.length)return;const a=Array.from(document.querySelectorAll(".js-relatorio-filter")),o=Array.from(document.querySelectorAll("[data-series-row]")),c=b(a,d());let s=S(n,c);const l=e.getContext("2d");let h=null;l&&typeof Chart<"u"&&(h=new Chart(l,{type:"line",data:{labels:n.map(m=>m.label),datasets:[{label:"PatrimÃ´nio (acumulado)",data:s.map(m=>m.cumulative),borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.2)",tension:.2,fill:!0}]},options:{scales:{y:{ticks:{callback:m=>{const i=typeof m=="string"?Number(m):m;return u(Number.isFinite(i)?Number(i):0)}}}}}})),f(o,s);const p=()=>{s=S(n,b(a,d())),f(o,s),O(h,s)};a.forEach(m=>m.addEventListener("change",p))});
